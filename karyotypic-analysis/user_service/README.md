# karyotypic_analysis user_service
## Введение
Этот сервис представляет собой API БД пользователей, разработанное с использованием FastAPI. В качестве БД выступает [**PostgreSQL**](https://www.postgresql.org/). Для реализации миграций используется [**Alembic**](https://alembic.sqlalchemy.org/en/latest/).

Cтруктура проекта: 
```bash
user_service
├── alembic                     # Папка для миграций базы данных
│   ├── env.py                  # Конфигурация среды для Alembic
│   ├── README                  
│   ├── script.py.mako          # Шаблон для генерации миграций
│   └── versions                # Папка с версиями миграций
│       ├── 6a8904ca6b6d_image_bytes.py  # Миграция для поля image_bytes
│       ├── cbd6504d75c8_initial_revision.py  # Начальная миграция
├── application.py              # Конфигурация приложения
├── auth                        # Рут для аутентификации
│   ├── __init__.py             
│   ├── router.py               # Маршрутизация для аутентификации
│   ├── schemas.py              # Схемы данных для аутентификации
│   └── utils.py                # Утилиты для аутентификации
├── database.py                 # Настройка подключения к базе данных
├── Dockerfile                  # Инструкции для сборки Docker-образа
├── __init__.py                 
├── main.py                     # Основной файл для запуска приложения
├── models.py                   # Определение моделей базы данных
├── notebooks                   # Рут для ноутбуков
│   ├── __init__.py             
│   ├── router.py               # Маршрутизация для ноутбуков
│   └── schemas.py              # Схемы данных для ноутбуков
├── README.md                    
├── requirements.txt            # Список зависимостей проекта
├── users                       # Рут для пользователями
│   ├── __init__.py             
│   ├── router.py               # Маршрутизация для пользователей
│   └── schemas.py              # Схемы данных для пользователей
├── utils.py                    # Общие утилиты для проекта
└── wait-for-db.sh              # Скрипт для ожидания готовности базы данных
```
Под ноутбуками подразумевается совокупность результатов нейросети и комментариев пользователей к ним. 
<br></br>
## Струтура БД

## Сущности

### User
- **id** (PK)
- **username** (UNIQUE)
- **email** (UNIQUE)
- **password**

### Notebook
- **id** (PK)
- **title**
- **user_id** (FK → User.id)

### Image
- **id** (PK)
- **image_src**
- **boxes**
- **notebook_id** (FK → Notebook.id)
- **user_id** (FK → User.id)

### Comment
- **id** (PK)
- **comment**
- **notebook_id** (FK → Notebook.id)
- **user_id** (FK → User.id)

### Связи

- **User** 1 --- * **Notebook**
- **Notebook** 1 --- * **Image**
- **Notebook** 1 --- * **Comment**
- **User** 1 --- * **Image**
- **User** 1 --- * **Comment**
<br></br>
## Эндпоинты

## User Methods
### Эндпоинт: /user/users/me/

**Метод:** `GET`  
**Описание:** Получение информации о текущем аутентифицированном пользователе.

#### Параметры

Нет параметров запроса.

#### Ответы

| Код | Описание                | Ссылки |
|-----|-------------------------|--------|
| 200 | Успешный ответ          |        |

**Media Type:** Управляет заголовком `Accept`.

**Пример успешного ответа:**

```json
{
  "username": "string",         // Имя пользователя
  "email": "user@example.com",  // Электронная почта пользователя
  "password": "string"          // Пароль пользователя (обычно не возвращается по соображениям безопасности)
}
```
### Эндпоинт: /user/delete/{user_id}

**Метод:** `DELETE`  
**Описание:** Удаление пользователя по указанному идентификатору.

#### Параметры

| Имя      | Описание                     |
|----------|------------------------------|
| user_id  | **integer** (path) - Идентификатор пользователя, которого необходимо удалить. **Обязательный** параметр. |

#### Ответы

| Код | Описание                | Ссылки |
|-----|-------------------------|--------|
| 200 | Успешный ответ          |        |
| 422 | Ошибка валидации        |        |

**Media Type:** Управляет заголовком `Accept`.

**Пример успешного ответа:**

```json
"string" // Сообщение об успешном удалении пользователя
```
### Эндпоинт: /user/get/notebooks_list

**Метод:** `GET`  
**Описание:** Получение списка ноутбуков пользователя.

#### Параметры

Нет параметров запроса.

#### Ответы

| Код | Описание                | Ссылки |
|-----|-------------------------|--------|
| 200 | Успешный ответ          |        |

**Media Type:** Управляет заголовком `Accept`.

**Пример успешного ответа:**

```json
[
  {
    // Объект ноутбука, содержащий id и title
  }
]
```
<br></br>
## Notebooks Methods
### Эндпоинт: /notebooks/add

**Метод:** `POST`  
**Описание:** Добавление нового ноутбука.

#### Параметры

Нет параметров запроса.

#### Тело запроса

**Запись:**  
- **Тип:** `object`  
- **Обязательный:** Да  
- **Описание:** Объект, содержащий данные для ового ноутбука.

**Структура объекта:**
```json
{
  "title": "string",
  "image": {
    "image_src": "string",
    "boxes": {
      "additionalProp1": [
        [
          0
        ]
      ],
      "additionalProp2": [
        [
          0
        ]
      ],
      "additionalProp3": [
        [
          0
        ]
      ]
    }
  },
  "comment": {
    "comment": "string"
  }
}
```
**Параметры тела запроса**

**title**
- **Тип:** string  
- **Обязательный:** Да  
- **Описание:** Название ноутбука.

**image**
- **Тип:** object  
- **Обязательный:** Да  
- **Описание:** Объект, содержащий информацию об изображении.  
- **Свойства:**
  - **image_src**
    - **Тип:** string  
    - **Обязательный:** Да  
    - **Описание:** изображение в base64.
  - **boxes**
    - **Тип:** object  
    - **Обязательный:** Да  
    - **Описание:** Объект, содержащий дополнительные свойства с массивами, представляющими данные о боксовых координатах.

**comment**
- **Тип:** object  
- **Обязательный:** Да  
- **Описание:** Объект, содержащий комментарий.  
- **Свойства:**
  - **comment**
    - **Тип:** string  
    - **Обязательный:** Да  
    - **Описание:** Текст комментария.

### Ответы

| Код | Описание          | Ссылки |
|-----|-------------------|--------|
| 200 | Успешный ответ    |        |
| 422 | Ошибка валидации |        |

**Media Type:** Управляет заголовком `Accept`.

**Пример успешного ответа:**

```json
"string" // Сообщение об успешной записи ноутбука
```
### Эндпоинт: /notebooks/get/{notebook_id}

**Метод:** `GET`  
**Описание:** Получение ноутбука по идентификатору.

#### Параметры

| Имя          | Описание                     |
|--------------|------------------------------|
| notebook_id  | **integer** (path) - Обязательный параметр, идентификатор ноутбука. |

#### Ответы

| Код | Описание                | Ссылки |
|-----|-------------------------|--------|
| 200 | Успешный ответ          |        |
| 422 | Ошибка валидации       |        |

**Media Type:** Управляет заголовком `Accept`.

**Пример успешного ответа:**

```json
"string" // Сообщение об успешном получении ноутбука
```
### Эндпоинт: /notebooks/delete/{notebook_id}

**Метод:** `DELETE`  
**Описание:** Удаление ноутбука по идентификатору.

#### Параметры

| Имя          | Описание                     |
|--------------|------------------------------|
| notebook_id  | **integer** (path) - Обязательный параметр, идентификатор ноутбука. |

#### Ответы

| Код | Описание                | Ссылки |
|-----|-------------------------|--------|
| 200 | Успешный ответ          |        |
| 422 | Ошибка валидации       |        |

**Media Type:** Управляет заголовком `Accept`.

**Пример успешного ответа:**

```json
"string" //  Сообщение об успешном удалении ноутбука
```
### Эндпоинт: /notebooks/update/{notebook_id}

**Метод:** `PUT`  
**Описание:** Обновление ноутбука по идентификатору.

#### Параметры

| Имя          | Описание                     |
|--------------|------------------------------|
| notebook_id  | **integer** (path) - Обязательный параметр, идентификатор оутбука. |

#### Тело запроса

**Запись:**  
- **Тип:** `object`  
- **Обязательный:** Да  
- **Описание:** Объект, содержащий данные для обновления записной книжки.

**Структура объекта:**
```json
{
  "title": "string",
  "comment": {
    "comment": "string"
  }
}
```
**title**
- **Тип:** string  
- **Обязательный:** Да  
- **Описание:** Название ноутбука.

**comment**
- **Тип:** object  
- **Обязательный:** Да  
- **Описание:** Объект, содержащий комментарий.  
- **Свойства:**
  - **comment**
    - **Тип:** string  
    - **Обязательный:** Да  
    - **Описание:** Текст комментария.

#### Ответы

| Код | Описание                | Ссылки |
|-----|-------------------------|--------|
| 200 | Успешный ответ          |        |
| 422 | Ошибка валидации       |        |

**Media Type:** Управляет заголовком `Accept`.

**Пример успешного ответа:**

```json
"string" //  Сообщение об успешном обновлении ноутбука
```
<br></br>
## Auth Methods

### Эндпоинт: /register

**Метод:** `POST`  
**Описание:** Регистрация пользователя.

#### Параметры

Нет параметров запроса.

#### Тело запроса

**Запись:**  
- **Тип:** `object` 
- **Обязательный:** Да  
- **Описание:** Объект, содержащий данные для регистрации пользователя.

**Структура объекта:**
```json
{
  "username": "string",         // Имя пользователя
  "email": "user@example.com",  // Электронная почта пользователя
  "password": "string"          // Пароль пользователя 
}
```
**username**
- **Тип:** string
- **Обязательный:** Да
- **Описание:**  Имя пользователя.

**email**
- **Тип:** string
- **Обязательный:** Да
- **Описание:** Адрес электронной почты пользователя.

**password**
- **Тип:** string
- **Обязательный:** Да
- **Описание:** Пароль пользователя.

#### Ответы

| Код | Описание                | Ссылки |
|-----|-------------------------|--------|
| 200 | Успешный ответ          |        |
| 422 | Ошибка валидации       |        |

**Media Type:** Управляет заголовком `Accept`.

**Пример успешного ответа:**

```json
"string" //  Сообщение об успешной регистрации
```
### Эндпоинт: /api/token

**Метод:** `POST`  
**Описание:** Получение токена доступа для авторизации.

#### Параметры

Нет параметров запроса.

#### Тело запроса

**Запись:**  
- **Тип:** `object`  
- **Обязательный:** Да  
- **Описание:** Объект, содержащий данные для получения токена доступа.

**Структура объекта:**
```json
{
  "grant_type": "password",  // Тип гранта, должен быть равен "password".
  "username": "string",      // Имя пользователя для аутентификации.
  "password": "string",      // Пароль пользователя.
  "scope": "string",         // Область доступа, запрашиваемая для токена (необязательный).
  "client_id": "string",     // Идентификатор клиента, если требуется (необязательный).
  "client_secret": "string"  // Секрет клиента, если требуется (необязательный).
}
```
**grant_type**
- **Тип:** string
- **Обязательный:** Да
- **Описание:** Тип гранта, должен быть равен "password".

**username**
- **Тип:** string
- **Обязательный:** Да
- **Описание:** Имя пользователя для аутентификации.

**password**
- **Тип:** string
- **Обязательный:** Да
- **Описание:** Пароль пользователя.

**scope**
- **Тип:** string
- **Обязательный:** Нет
- **Описание:** Область доступа, запрашиваемая для токена.

**client_id**
- **Тип:** string
- **Обязательный:** Нет
- **Описание:** Идентификатор клиента, если требуется.

**client_secret**
- **Тип:** string
- **Обязательный:** Нет
- **Описание:** Секрет клиента, если требуется.

#### Ответы

| Код | Описание                | Ссылки |
|-----|-------------------------|--------|
| 200 | Успешный ответ          |        |
| 422 | Ошибка валидации       |        |

**Media Type:** Управляет заголовком `Accept`.

**Пример успешного ответа:**

```json
{
  "access_token": "string", // Токен доступа, который используется для авторизации.
  "token_type": "string" // Тип токена (например, "Bearer").
}
```